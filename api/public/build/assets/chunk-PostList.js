import{_ as D,f,o as d,a as e,t as g,k as c,D as E,h as w,e as F,j as $,s as C,l as I,a1 as P,c as T,d as b,w as j,T as x,F as U,i as S,N as B,p as L,I as N}from"./app2.js";import{N as V}from"./chunk-NavigationDrawer.js";import{S as q}from"./chunk-SearchBar.js";const O={class:"post-content"},A={class:"post-title"},Y={class:"post-desc no-wrap"},z={__name:"PostListItem",props:["post"],setup(m){return(h,r)=>(d(),f("div",{class:"post-card",onClick:r[0]||(r[0]=p=>h.$emit("click"))},[e("div",O,[e("div",A,g(m.post.postTitle),1),e("div",Y,g(m.post.postDesc),1)])]))}},J=D(z,[["__scopeId","data-v-7b86cc35"]]),H={key:0,class:"modal-overlay"},R={class:"modal-content"},G={key:0,class:"error-message"},K={class:"modal-button"},Q=["disabled"],W={__name:"EditForumModal",props:{show:Boolean,forum:{type:Object,required:!0}},emits:["close","updated"],setup(m,{emit:h}){const r=m,p=h,s=c({forumTitle:"",forumDesc:"",Categories:""}),i=c(!1),l=c("");E(()=>r.forum,u=>{u&&(s.value={forumTitle:u.forumTitle,forumDesc:u.forumDesc,Categories:u.Categories||""})},{immediate:!0});async function v(){i.value=!0,l.value="";try{const u=await fetch(`/api/forums/${r.forum.forumID}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s.value)});if(!u.ok){const t=await u.json();l.value=t.message||"Failed to update forum.",i.value=!1;return}p("updated"),p("close"),window.location.reload()}catch{l.value="An error occurred while updating the forum."}finally{i.value=!1}}return(u,t)=>m.show?(d(),f("div",H,[e("div",R,[e("form",{onSubmit:F(v,["prevent"]),class:"forum-form"},[$(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>s.value.forumTitle=n),type:"text",placeholder:"Forum Title",required:"",class:"form-input"},null,512),[[C,s.value.forumTitle]]),$(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=n=>s.value.forumDesc=n),placeholder:"Forum Description",required:"",class:"form-input",rows:"4"},null,512),[[C,s.value.forumDesc]]),$(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>s.value.Categories=n),type:"text",placeholder:"Categories (comma separated)",class:"form-input"},null,512),[[C,s.value.Categories]]),l.value?(d(),f("div",G,g(l.value),1)):w("",!0),e("div",K,[e("button",{onClick:t[3]||(t[3]=n=>u.$emit("close")),class:"close-btn"}," Cancel "),e("button",{type:"submit",disabled:i.value,class:"submit-btn"},"Update ",8,Q)])],32)])])):w("",!0)}},X=D(W,[["__scopeId","data-v-d0c90337"]]),Z={key:1,class:"delete-confirm-overlay"},ee={class:"delete-confirm-modal"},te={class:"delete-confirm-actions"},oe={__name:"MenuPopover",props:{forum:{type:Object,required:!0}},emits:["delete","updated"],setup(m,{emit:h}){const r=m,p=h,s=c(!1),i=c(null),l=c(!1),v=c(!1);function u(){s.value=!s.value}function t(){s.value=!1}function n(){l.value=!0,t()}function y(){p("updated"),l.value=!1}async function M(){try{(await fetch(`/api/forums/${r.forum.forumID}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}})).ok?(v.value=!1,window.location.href="/forum"):(console.error("Failed to delete forum"),v.value=!1)}catch(o){console.error("An error occurred:",o),v.value=!1}}function k(o){i.value&&!i.value.contains(o.target)&&t()}return I(()=>{document.addEventListener("mousedown",k)}),P(()=>{document.removeEventListener("mousedown",k)}),(o,a)=>(d(),f(U,null,[e("div",{class:"menu-popover-wrapper",ref_key:"wrapper",ref:i},[e("button",{class:"menu-btn",onClick:u,"aria-label":"Open menu"},a[3]||(a[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"21",height:"21",viewBox:"0 0 24 24",fill:"#aaa","stroke-width":"1",class:"ai ai-MoreVerticalFill"},[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4z"}),e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12 10a2 2 0 1 1 0 4 2 2 0 0 1 0-4z"}),e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12 18a2 2 0 1 1 0 4 2 2 0 0 1 0-4z"})],-1)])),b(x,{name:"fade"},{default:j(()=>[s.value?(d(),f("div",{key:0,class:"menu-popover",onClick:t},[e("ul",null,[e("li",{onClick:n},a[4]||(a[4]=[e("span",null,"Edit Forum",-1)])),e("li",{onClick:a[0]||(a[0]=_=>{v.value=!0,t()}),class:"danger"},a[5]||(a[5]=[e("span",null,"Delete",-1)]))])])):w("",!0)]),_:1})],512),l.value?(d(),T(X,{key:0,show:l.value,forum:m.forum,onClose:a[1]||(a[1]=_=>l.value=!1),onUpdated:y},null,8,["show","forum"])):w("",!0),v.value?(d(),f("div",Z,[e("div",ee,[a[6]||(a[6]=e("div",{class:"delete-confirm-title"},"Delete Forum?",-1)),a[7]||(a[7]=e("div",{class:"delete-confirm-message"}," Forums cannot be restored if deleted. ",-1)),e("div",te,[e("button",{class:"cancel-btn",onClick:a[2]||(a[2]=_=>v.value=!1)},"Cancel"),e("button",{class:"delete-btn",onClick:M},"Delete")])])])):w("",!0)],64))}},se=D(oe,[["__scopeId","data-v-2589ac6a"]]),ae={key:0,class:"modal-overlay"},le={class:"modal-content"},re={key:0,class:"error-message"},ne={class:"modal-button"},ie=["disabled"],ue={__name:"CreatePostModal",props:{show:Boolean,forumId:{type:String,required:!0}},emits:["close","created"],setup(m,{emit:h}){const r=m,p=h,s=c({postTitle:"",postDesc:""}),i=c(!1),l=c(""),v=c("");I(async()=>{try{const t=await fetch("/api/user");if(t.ok){const n=await t.json();v.value=n.id||""}}catch(t){console.error("Failed to fetch user:",t)}});async function u(){i.value=!0,l.value="";try{const t=await fetch("/api/posts",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({postTitle:s.value.postTitle,postDesc:s.value.postDesc,forumID:r.forumId,userID:v.value})});if(!t.ok){const n=await t.json();l.value=n.message||"Failed to create post.",i.value=!1;return}p("created"),p("close"),s.value={postTitle:"",postDesc:""}}catch{l.value="An error occurred while creating the post."}finally{i.value=!1}}return(t,n)=>m.show?(d(),f("div",ae,[e("div",le,[e("form",{onSubmit:F(u,["prevent"]),class:"post-form"},[$(e("input",{"onUpdate:modelValue":n[0]||(n[0]=y=>s.value.postTitle=y),type:"text",placeholder:"Post Title",required:"",class:"form-input"},null,512),[[C,s.value.postTitle]]),$(e("textarea",{"onUpdate:modelValue":n[1]||(n[1]=y=>s.value.postDesc=y),placeholder:"Post Description",required:"",class:"form-input",rows:"4"},null,512),[[C,s.value.postDesc]]),l.value?(d(),f("div",re,g(l.value),1)):w("",!0),e("div",ne,[e("button",{onClick:n[2]||(n[2]=y=>t.$emit("close")),class:"close-btn"}," Cancel "),e("button",{type:"submit",disabled:i.value,class:"submit-btn"},"Create ",8,ie)])],32)])])):w("",!0)}},ce=D(ue,[["__scopeId","data-v-be25ca0c"]]),de={class:"post-list-bg"},pe={class:"search-menu-row"},me={key:0,class:"forum-header"},ve={class:"header-main"},fe={class:"title-row"},he={class:"forum-title"},we={class:"category-tag"},_e={class:"desc-row"},ye={class:"forum-desc"},ge=["href"],be={class:"post-list-content"},ke={class:"post-list-grid"},$e={__name:"PostList",setup(m){const h=c([]),r=c(null),p=c(""),s=c(!0);let i=0;const l=c(null);function v(o){window.location.href=`/posts/${o}`}function u(){const o=window.scrollY;o>i?s.value=!1:o<i&&(s.value=!0),i=o}const t=c(!1),n=S(()=>!l.value||!r.value?!1:l.value.role==="admin"||l.value.id===r.value.organiserID);I(()=>{const o=new URLSearchParams(window.location.search);p.value=o.get("forum_id"),y(),M(),k(),s.value=!0,i=window.scrollY,window.addEventListener("scroll",u)});async function y(){try{const o=await fetch("/api/user");o.ok?l.value=await o.json():l.value=null}catch(o){console.error("Failed to fetch current user:",o),l.value=null}}async function M(){if(p.value)try{const o=await fetch(`/api/forum/${p.value}`);r.value=await o.json()}catch(o){console.error("Failed to fetch forum details:",o)}}async function k(){if(p.value)try{const o=await fetch(`/api/posts?forum_id=${p.value}`);h.value=await o.json()}catch(o){console.error("Failed to refresh posts:",o)}}return P(()=>{window.removeEventListener("scroll",u)}),(o,a)=>(d(),f("div",de,[b(x,{name:"fade-slide-navbar"},{default:j(()=>[s.value?(d(),T(B,{key:0})):w("",!0)]),_:1}),b(V),e("div",pe,[b(q),e("button",{class:"menu-btn create-btn",onClick:a[0]||(a[0]=_=>t.value=!0)},a[3]||(a[3]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 4V20M4 12H20",stroke:"#aaa","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Create",-1)])),n.value?(d(),T(se,{key:0,forum:r.value,onUpdated:a[1]||(a[1]=_=>o.$emit("updated"))},null,8,["forum"])):w("",!0)]),r.value?(d(),f("div",me,[e("div",ve,[e("div",fe,[e("h1",he,g(r.value.forumTitle),1),e("span",we,g(r.value.Categories),1)]),e("div",_e,[e("p",ye,g(r.value.forumDesc),1),e("a",{href:`/profile/${r.value.organiserID}`,class:"organiser-link"},g(r.value.organiserName),9,ge)])])])):w("",!0),e("div",be,[e("div",ke,[(d(!0),f(U,null,L(h.value,_=>(d(),T(J,{key:_.postID,post:_,onClick:De=>v(_.postID)},null,8,["post","onClick"]))),128))])]),b(ce,{show:t.value,"forum-id":p.value,onClose:a[2]||(a[2]=_=>t.value=!1),onCreated:k},null,8,["show","forum-id"]),b(N)]))}},Ce=D($e,[["__scopeId","data-v-d26f7b4e"]]),Fe={__name:"PostList",setup(m){return(h,r)=>(d(),f("div",null,[b(Ce)]))}};export{Fe as default};
