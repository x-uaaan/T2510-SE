import{N as I}from"./NavigationDrawer.js";import{_ as g,k as p,D as N,f as v,h,o as m,a as e,e as M,j as k,s as C,t as b,l as $,a1 as T,c as x,d as _,w as O,T as B,F as y,i as j,p as U,N as F,I as L}from"./app2.js";const A={key:0,class:"modal-overlay"},V={class:"modal-content"},q={key:0,class:"error-message"},Y={class:"modal-button"},z=["disabled"],J={__name:"EditPostModal",props:{show:Boolean,post:{type:Object,required:!0}},emits:["close","updated"],setup(r,{emit:u}){const c=r,d=u,s=p({postTitle:"",postDesc:""}),i=p(!1),a=p("");N(()=>c.post,o=>{o&&(s.value={postTitle:o.postTitle,postDesc:o.postDesc})},{immediate:!0});async function t(){i.value=!0,a.value="";try{const o=await fetch(`/api/posts/${c.post.postID}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s.value)});if(!o.ok){const n=await o.json();a.value=n.message||"Failed to update post.",i.value=!1;return}d("updated"),d("close"),window.location.reload()}catch{a.value="An error occurred while updating the post."}finally{i.value=!1}}return(o,n)=>r.show?(m(),v("div",A,[e("div",V,[e("form",{onSubmit:M(t,["prevent"]),class:"post-form"},[k(e("input",{"onUpdate:modelValue":n[0]||(n[0]=f=>s.value.postTitle=f),type:"text",placeholder:"Post Title",required:"",class:"form-input"},null,512),[[C,s.value.postTitle]]),k(e("textarea",{"onUpdate:modelValue":n[1]||(n[1]=f=>s.value.postDesc=f),placeholder:"Post Description",required:"",class:"form-input",rows:"4"},null,512),[[C,s.value.postDesc]]),a.value?(m(),v("div",q,b(a.value),1)):h("",!0),e("div",Y,[e("button",{onClick:n[2]||(n[2]=f=>o.$emit("close")),class:"close-btn"}," Cancel "),e("button",{type:"submit",disabled:i.value,class:"submit-btn"},"Update ",8,z)])],32)])])):h("",!0)}},G=g(J,[["__scopeId","data-v-dda9d8bb"]]),H={key:1,class:"delete-confirm-overlay"},K={class:"delete-confirm-modal"},Q={class:"delete-confirm-actions"},R={__name:"MenuPopoverPost",props:{post:{type:Object,required:!0}},emits:["delete","updated"],setup(r,{emit:u}){const c=r,d=u,s=p(!1),i=p(null),a=p(!1),t=p(!1);function o(){s.value=!s.value}function n(){s.value=!1}function f(){a.value=!0,n()}function S(){d("updated"),a.value=!1}async function E(){try{(await fetch(`/api/posts/${c.post.postID}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}})).ok?(t.value=!1,window.location.href=`/posts?forum_id=${c.post.forumID}`):(console.error("Failed to delete post"),t.value=!1)}catch(w){console.error("An error occurred:",w),t.value=!1}}function D(w){i.value&&!i.value.contains(w.target)&&n()}return $(()=>{document.addEventListener("mousedown",D)}),T(()=>{document.removeEventListener("mousedown",D)}),(w,l)=>(m(),v(y,null,[e("div",{class:"menu-popover-wrapper",ref_key:"wrapper",ref:i},[e("button",{class:"menu-btn",onClick:o,"aria-label":"Open menu"},l[3]||(l[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"21",height:"21",viewBox:"0 0 24 24",fill:"#aaa","stroke-width":"1",class:"ai ai-MoreVerticalFill"},[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4z"}),e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12 10a2 2 0 1 1 0 4 2 2 0 0 1 0-4z"}),e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12 18a2 2 0 1 1 0 4 2 2 0 0 1 0-4z"})],-1)])),_(B,{name:"fade"},{default:O(()=>[s.value?(m(),v("div",{key:0,class:"menu-popover",onClick:n},[e("ul",null,[e("li",{onClick:f},l[4]||(l[4]=[e("span",null,"Edit Post",-1)])),e("li",{onClick:l[0]||(l[0]=P=>{t.value=!0,n()}),class:"danger"},l[5]||(l[5]=[e("span",null,"Delete",-1)]))])])):h("",!0)]),_:1})],512),a.value?(m(),x(G,{key:0,show:a.value,post:r.post,onClose:l[1]||(l[1]=P=>a.value=!1),onUpdated:S},null,8,["show","post"])):h("",!0),t.value?(m(),v("div",H,[e("div",K,[l[6]||(l[6]=e("div",{class:"delete-confirm-title"},"Delete Post?",-1)),l[7]||(l[7]=e("div",{class:"delete-confirm-message"}," Posts cannot be restored if deleted. ",-1)),e("div",Q,[e("button",{class:"cancel-btn",onClick:l[2]||(l[2]=P=>t.value=!1)},"Cancel"),e("button",{class:"delete-btn",onClick:E},"Delete")])])])):h("",!0)],64))}},W=g(R,[["__scopeId","data-v-7bc75092"]]),X={class:"post-card-single"},Z={class:"post-header-row"},ee={class:"post-title-container"},te={class:"post-title"},oe={class:"post-desc"},se={class:"right-side"},ne={class:"post-meta"},ae=["href"],le={class:"comments-section"},re={class:"comments-list"},ie={class:"comment-text"},ce={__name:"PostShowCard",props:{post:Object},setup(r){const u=r,c=p(""),d=p(null),s=j(()=>!d.value||!u.post?!1:d.value.role==="admin"||d.value.id===u.post.authorId);$(()=>{i()});async function i(){try{const t=await fetch("/api/user");t.ok?d.value=await t.json():d.value=null}catch(t){console.error("Failed to fetch current user:",t),d.value=null}}async function a(){if(c.value.trim())try{const t=await fetch(`/api/posts/${u.post.postID}/comments`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({comment:c.value})});if(t.ok){const o=await t.json();u.post.comments=o.comments,c.value=""}else console.error("Failed to add comment")}catch(t){console.error("An error occurred:",t)}}return(t,o)=>(m(),v(y,null,[e("div",X,[e("div",Z,[e("div",ee,[e("div",te,b(r.post.postTitle),1),e("div",oe,b(r.post.postDesc),1)]),e("div",se,[s.value?(m(),x(W,{key:0,class:"menu-popover-margin",post:r.post},null,8,["post"])):h("",!0),e("div",ne,[e("a",{href:`/profile/${r.post.authorId}`,class:"author-link"},b(r.post.author),9,ae)])])]),o[1]||(o[1]=e("hr",{class:"divider",style:{"margin-top":"20px","margin-bottom":"20px"}},null,-1)),e("div",le,[e("ul",re,[(m(!0),v(y,null,U(r.post.comments,(n,f)=>(m(),v("li",{key:f,class:"comment-item"},[e("div",ie,b(n),1)]))),128))])])]),e("form",{class:"add-comment-row",onSubmit:M(a,["prevent"])},[k(e("input",{"onUpdate:modelValue":o[0]||(o[0]=n=>c.value=n),type:"text",class:"add-comment-input",placeholder:"Add a comment..."},null,512),[[C,c.value]]),o[2]||(o[2]=e("button",{class:"add-comment-btn outline",type:"submit"},"Post",-1))],32)],64))}},de=g(ce,[["__scopeId","data-v-48bca2dc"]]),ue={class:"post-show-bg"},pe={class:"post-show-content"},me={__name:"PostShow",props:{post:Object},setup(r){const u=r,c=p(""),d=j(()=>c.value?{...u.post,comments:u.post.comments.filter(t=>t.toLowerCase().includes(c.value.toLowerCase()))}:u.post),s=p(!0);let i=0;function a(){const t=window.scrollY;t>i?s.value=!1:t<i&&(s.value=!0),i=t}return $(()=>{s.value=!0,i=window.scrollY,window.addEventListener("scroll",a)}),T(()=>{window.removeEventListener("scroll",a)}),(t,o)=>(m(),v(y,null,[e("div",ue,[_(F),_(I),e("div",pe,[_(de,{post:d.value},null,8,["post"])])]),_(L)],64))}},he=g(me,[["__scopeId","data-v-5794907c"]]);export{he as default};
